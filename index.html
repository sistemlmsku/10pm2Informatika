function doPost(e) {
  try {
    var ss = SpreadsheetApp.openById("1QoFS738810fYCIG3Tm2kgR08ry4wtRQ_pzta0OI1xPY");
    var sheet = ss.getSheetByName("DataSiswa") || ss.insertSheet("DataSiswa");

    // Buat header jika belum ada
    if (sheet.getLastRow() === 0) {
      sheet.appendRow([
        "Timestamp", "Nama", "Kelas", "Nilai",
        "Durasi Materi 1", "Durasi Materi 2",
        "Durasi Materi 3", "Durasi Materi 4",
        "Status Absensi", "Email"
      ]);
    }

    // Ambil data JSON dari POST body
    var data = JSON.parse(e.postData.contents);

    // Simpan data ke spreadsheet
    sheet.appendRow([
      new Date(),
      data.nama || "",
      data.kelas || "10 PM 2",
      Number(data.nilai) || 0,
      Number(data.durasi_materi1) || 0,
      Number(data.durasi_materi2) || 0,
      Number(data.durasi_materi3) || 0,
      Number(data.durasi_materi4) || 0,
      data.status_absensi || "",
      data.email || ""
    ]);

    return ContentService
      .createTextOutput(JSON.stringify({ status: "success" }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (err) {
    return ContentService
      .createTextOutput(JSON.stringify({ status: "error", message: err.message }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
